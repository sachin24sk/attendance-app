<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Attendance Dashboard</title>

<style>

body{
font-family:Segoe UI;
background:#eef2f7;
padding:15px;
margin:0;
}

.topBar{
display:flex;
flex-wrap:wrap;
gap:8px;
margin-bottom:15px;
}

select,input,button{
padding:8px;
border-radius:6px;
border:1px solid #ccc;
font-size:14px;
}

.stats{
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:10px;
}

.card{
background:white;
padding:10px;
border-radius:8px;
font-weight:bold;
flex:1;
min-width:120px;
text-align:center;
}

.tableWrap{
overflow-x:auto;
}

table{
width:100%;
border-collapse:collapse;
background:white;
min-width:500px;
}

th{
background:#1976d2;
color:white;
padding:8px;
}

td{
padding:8px;
text-align:center;
border-bottom:1px solid #eee;
}

img{
width:40px;
height:40px;
border-radius:50%;
}

</style>
</head>

<body>

<h3>ðŸ“Š Attendance Dashboard</h3>

<div class="topBar">
<select id="subjectFilter"><option value="">All</option></select>
<input id="searchBox" placeholder="Search">
</div>

<div class="stats">
<div class="card">ðŸ‘¥ Total <span id="totalCount">0</span></div>
<div class="card">ðŸ“… Today <span id="todayCount">0</span></div>
</div>

<div class="tableWrap">
<table>
<thead>
<tr>
<th>Photo</th>
<th>Name</th>
<th>Subject</th>
<th>Date</th>
<th>Time</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<script>

const tableBody=document.getElementById("tableBody");
const subjectFilter=document.getElementById("subjectFilter");
const searchBox=document.getElementById("searchBox");

const totalCount=document.getElementById("totalCount");
const todayCount=document.getElementById("todayCount");

const password="12345";
let allData=[];

function loadAttendance(){
fetch("/api/admin/attendance?password="+password)
.then(r=>r.json())
.then(data=>{
allData=data;
fillDropdown(data);
applyFilters();
});
}

function fillDropdown(data){
subjectFilter.innerHTML='<option value="">All</option>';
[...new Set(data.map(d=>d.subject))].forEach(s=>{
const o=document.createElement("option");
o.value=s;
o.textContent=s;
subjectFilter.appendChild(o);
});
}

function renderTable(data){

tableBody.innerHTML="";
const today=new Date().toLocaleDateString();
let todayTotal=0;

data.forEach(a=>{
if(a.date===today) todayTotal++;

const row=document.createElement("tr");
row.innerHTML=`
<td><img src="${a.photo}"></td>
<td>${a.name}</td>
<td>${a.subject}</td>
<td>${a.date}</td>
<td>${a.time}</td>`;
tableBody.appendChild(row);
});

totalCount.textContent=data.length;
todayCount.textContent=todayTotal;
}

function applyFilters(){

let filtered=[...allData];

if(subjectFilter.value)
filtered=filtered.filter(d=>d.subject===subjectFilter.value);

if(searchBox.value)
filtered=filtered.filter(d=>d.name.toLowerCase().includes(searchBox.value.toLowerCase()));

renderTable(filtered);
}

subjectFilter.onchange=applyFilters;
searchBox.oninput=applyFilters;

setInterval(loadAttendance,10000);
loadAttendance();

</script>

</body>
</html>
