<!DOCTYPE html>
<html>
<head>
<title>Attendance</title>

<style>
body{
font-family:Segoe UI;
background:#f2f4f7;
padding:20px;
}

h2{
margin-bottom:10px;
}

select{
padding:8px;
margin-bottom:15px;
border-radius:6px;
}

table{
width:100%;
border-collapse:collapse;
background:white;
}

th{
background:#2c6fb7;
color:white;
padding:10px;
}

td{
padding:10px;
text-align:center;
border-bottom:1px solid #eee;
}

img{
width:45px;
height:45px;
border-radius:50%;
}
</style>
</head>

<body>

<h2>üìä Attendance</h2>

<!-- ‚≠ê SUBJECT DROPDOWN -->
<select id="subjectFilter">
<option value="">All Subjects</option>
</select>

<table>
<thead>
<tr>
<th>Photo</th>
<th>Name</th>
<th>Subject</th>
<th>Date</th>
<th>Time</th>
</tr>
</thead>

<tbody id="tableBody"></tbody>

</table>

<script>

const tableBody = document.getElementById("tableBody");
const subjectFilter = document.getElementById("subjectFilter");

const params = new URLSearchParams(window.location.search);
const password = params.get("password") || "12345";

let allData = [];

/* ‚≠ê LOAD ALL ATTENDANCE FIRST */
fetch("/api/admin/attendance?password=" + password)
.then(res => res.json())
.then(data => {

 console.log("FULL DATA:",data);

 allData = data;

 fillDropdown(data);
 renderTable(data);

});

/* ‚≠ê DROPDOWN SUBJECT LIST */
function fillDropdown(data){

 const subjects = [...new Set(data.map(d => d.subject))];

 subjects.forEach(s=>{
   const opt = document.createElement("option");
   opt.value = s;
   opt.textContent = s;
   subjectFilter.appendChild(opt);
 });

}

/* ‚≠ê TABLE RENDER FUNCTION */
function renderTable(data){

 tableBody.innerHTML="";

 if(!data.length){
   tableBody.innerHTML =
   "<tr><td colspan='5'>No Attendance Found</td></tr>";
   return;
 }

 data.forEach(a=>{

  const row=document.createElement("tr");

  row.innerHTML=`
   <td><img src="${a.photo}"></td>
   <td>${a.name}</td>
   <td>${a.subject}</td>
   <td>${a.date}</td>
   <td>${a.time}</td>
  `;

  tableBody.appendChild(row);

 });

}

/* ‚≠ê FILTER CHANGE */
subjectFilter.addEventListener("change",()=>{

 const value = subjectFilter.value;

 if(!value){
   renderTable(allData);
   return;
 }

 const filtered = allData.filter(d=>d.subject===value);

 renderTable(filtered);

});

</script>

</body>
</html>
