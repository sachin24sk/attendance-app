<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Smart Attendance</title>

<style>
body{
margin:0;
font-family:Segoe UI;
background:#1976d2;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
padding:15px;
}
.card{
background:white;
width:100%;
max-width:360px;
padding:20px;
border-radius:14px;
text-align:center;
}
input,button{
width:100%;
padding:12px;
margin-top:10px;
border-radius:8px;
}
video{
width:100%;
border-radius:10px;
margin-top:10px;
}
#status{
margin-top:10px;
background:#e3f2fd;
padding:10px;
border-radius:8px;
white-space:pre-line;
}
#subjectTitle{
font-weight:bold;
margin-bottom:8px;
color:#1976d2;
}
</style>
</head>

<body>

<div class="card">

<h3>ðŸŽ“ Smart Attendance</h3>
<div id="subjectTitle">Loading subject...</div>

<input id="name" placeholder="Enter Name">

<video id="video" autoplay playsinline></video>

<button onclick="capturePhoto()">Capture Photo</button>

<canvas id="canvas" width="300" height="220" style="display:none;"></canvas>

<button onclick="markAttendance()">Submit Attendance</button>

<div id="status">Ready...</div>

</div>

<script>

const video = document.getElementById("video");
const statusBox = document.getElementById("status");

let capturedPhoto = "";

/* SUBJECT HEADING LOAD */
fetch("/api/current-subject")
.then(r=>r.json())
.then(d=>{
document.getElementById("subjectTitle").innerText =
"Subject: " + d.subject;
});

/* MOBILE CAMERA */
navigator.mediaDevices.getUserMedia({
 video:{facingMode:"environment"}
})
.then(stream=>{
 video.srcObject = stream;
})
.catch(()=>{
 statusBox.innerText="Camera permission allow karo";
});

/* PHOTO CAPTURE */
function capturePhoto(){

const canvas=document.getElementById("canvas");
canvas.getContext("2d").drawImage(video,0,0,300,220);
capturedPhoto = canvas.toDataURL("image/png");

statusBox.innerText="Photo captured âœ”";

}

/* â­ FINAL ATTENDANCE FUNCTION */
function markAttendance(){

const name=document.getElementById("name").value.trim();

if(!name){
 statusBox.innerText="Name enter karo";
 return;
}

if(!capturedPhoto){
 statusBox.innerText="Photo capture karo";
 return;
}

statusBox.innerText="Sending attendance...";

/* LOCATION */
navigator.geolocation.getCurrentPosition(pos=>{

fetch("/api/attendance",{
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
  name:name,
  photo:capturedPhoto,
  latitude:pos.coords.latitude,
  longitude:pos.coords.longitude,
  time:new Date().toLocaleTimeString()
 })
})
.then(r=>r.json())
.then(d=>{
 statusBox.innerText =
 d.message + "\nSubject: " + d.subject + "\nDate: " + d.date;
})
.catch(()=>{
 statusBox.innerText="Server error";
});

},
()=>{
 statusBox.innerText="Location allow karo";
},
{enableHighAccuracy:true});

}

</script>


</body>
</html>

